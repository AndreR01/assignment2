#!/usr/bin/env bash
set -x
#num_col=$(head -n1 $1 | awk -F'\t' '{print NF;exit}')
#awk -F'\t' '{print NF}' $1
for arg in "$@"
do
    #read the header, get the NF and add one.
    #create a concat column of entity and year.a:L
    fields=$(head -n1 $arg | awk -F'\t' '{print NF;exit}')
    num_col=$(($fields+1))
    echo $num_col
    awk -F'\t' '(int($3) < 2011 || int($3) > 2021) || $2 == ""{next;}{print $0}' $arg | awk -F'\t' 'NR==1{$num_col="merge";print;next}{$NF="${1}${3}"' | sort -k1,1 -k3,3n | cut -f1-6 > "_$arg"
done

T=$(printf '\t')
entity=$(printf "Entity")
code=$(printf "Code")
year=$(printf "Year")
gdp=$(printf "GDP per capita")
popln=$(printf "Population")
homicide=$(printf "Homicide Rate")
life=$(printf "Life Expectancy")
cantril=$(printf "Cantril Ladder Score")

#awk 'NR==FNR{array[$1]=$3FS$4FS$5FS$6FS$7FS$8; next} { print $0,array[$1]}' file2 file1

#echo "Entity Code \t Year \t GDP per capita\t Population \t Homicide \t Life expectancy \t Cantril ladder score" > final_extract.txt


#awk -F, 'NR==FNR{a[$1]=$2;b[$1]=next}
#{if ($2 in a){$3=$2;$4=a[$2];delete a[$2];}}1' OFS="\t" _gdp-vs-happiness.tsv _homicide-rate-unodc.tsv _life-satisfaction-vs-life-expectancy.tsv
#awk 'BEGIN{FS=","} NR==1{print;next} {a[$2][$3]=$2 in a ? a[$2] " " $1 : $1} END{for(i in a) print a[i] "," i}'
